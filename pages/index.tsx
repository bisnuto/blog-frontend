import type { NextPage } from "next";
import Head from "next/head";
import Link from 'next/link'
import * as React from "react";
import Image from "next/image";
import { Button } from "@/components/elements/Button";
import styles from "@/styles/pages/Home.module.scss";
import { Animal } from "@/components/modules/Animal";
import { Covid } from "@/components/modules/Covid";

type THome = {
  id: number;
  meta: {
      type: string;
      detail_url: string;
      html_url: string;
      slug: string;
      first_published_at: string;
  },
  title: string;
  custom_title: string;
  intro: string;
  top_image: {
        id: 4,
        meta: {
            type: string;
            detail_url: string;
            download_url: string
        },
        title: string;
    }
  
}

// type THomeData = {
//   items: THome[];
// }
type THData = THome | null;


type TPost = {
  id: number;
  meta: {
      type: string;
      detail_url: string;
      html_url: string;
      slug: string;
      first_published_at: string;
  },
  title: string;
}
type TPostData = {
  meta: {
      total_count: number;
  },
  items: TPost[];
}
type TData = TPostData | null;

const Home: NextPage = () => {
  const [dataHome,setHomeData] = React.useState<THData>(null)
  const [data,setData] = React.useState<TData>(null)

  
console.log(dataHome);
const apiHomeUrl = "http://127.0.0.1:8000/api/v2/cms/pages/3/";
const apiBlogUrl = "http://127.0.0.1:8000/api/v2/cms/pages/?type=blog.BlogPage";

React.useEffect(() => {
    //For home page
    async function fetchHomeJSON() {
      try {
          const responseHome = await fetch(apiHomeUrl);
          const homeposts : THome = await responseHome.json();
          
          setHomeData(homeposts);
      } catch (error) {
          //console.error(error);
      }

    }
    fetchHomeJSON();
    //For blog pages
    async function fetchPostsJSON() {
        try {
            const response = await fetch(apiBlogUrl);
            const posts : TPostData = await response.json();
            
            setData(posts);
        } catch (error) {
            console.error(error);
        }

      }
      fetchPostsJSON();
},[])


    const imgSrc = dataHome
    ? `http://127.0.0.1:8000${dataHome.top_image.meta.download_url}`
    : "";
    console.log(imgSrc);

    return (
        <>
            <Head>
                <title>Fernando Blog</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <link rel="icon" href="/images/favicon.ico" />
            </Head>

            <section className={styles.Main}>
                <div>
                  <h1 className={styles.Title}>
                      {dataHome?.title}
                  </h1>
                  <h2>{dataHome?.custom_title}</h2>
                  <p>{dataHome?.intro}</p>
                </div>
  
                <div className={styles.Banner}>
                  
                  <Image
                  src={"http://127.0.0.1:8000/media/original_images/the-ghost2.jpg"}
                  // imgSrc
                  className={styles.BannerImage}
                  layout="fill"
                  objectFit="cover"
                  alt={dataHome?.top_image.title}
                  objectPosition="center"
                  />
                </div>

                <Animal
                  animal="Jaguar"
                />
                <Animal
                  animal="Monkey"
                />
                <section className={styles.Blog}>
                  <h2>Blog</h2>
                  <ul>
                  {data && data.items.map((post:TPost) => {
                       return (
                           <li className={styles.Product} key={post.id}>
                             <Link href={`/blog/${post.meta.slug}`}>
                               <a>
                                <p>{post.title}</p>
                               </a>
                              </Link>
                             
                           </li>
                       )
                   })}
                   </ul>
                </section>
                <section className={styles.Covid}>
                  <Covid/>
                </section> 


            </section>
        </>
    );
};

export default Home;
